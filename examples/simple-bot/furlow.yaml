# Simple FURLOW Bot Example
# A basic bot demonstrating core features

version: "0.1"

identity:
  name: "SimpleBot"

presence:
  status: online
  activity:
    type: watching
    text: "for /help"

intents:
  auto: true

state:
  storage:
    type: sqlite
    path: ./data/bot.db

  variables:
    command_count:
      type: number
      scope: global
      default: 0

# Commands
commands:
  # Basic ping command
  - name: ping
    description: Check if the bot is responsive
    actions:
      - reply:
          content: "Pong! Latency: ${bot.ping}ms"
          ephemeral: true

  # Hello command with user mention
  - name: hello
    description: Say hello to someone
    options:
      - name: user
        description: The user to greet
        type: user
        required: false
    actions:
      - reply:
          content: "Hello, ${options.user ? mention('user', options.user.id) : member.display_name}!"

  # Echo command
  - name: echo
    description: Echo a message
    options:
      - name: message
        description: The message to echo
        type: string
        required: true
    actions:
      - send_message:
          channel: "${channel.id}"
          content: "${options.message}"
      - reply:
          content: "Message sent!"
          ephemeral: true

  # Server info command
  - name: serverinfo
    description: Get information about this server
    actions:
      - reply:
          embeds:
            - title: "${guild.name}"
              thumbnail:
                url: "https://cdn.discordapp.com/icons/${guild.id}/${guild.icon}.png"
              color: "#5865F2"
              fields:
                - name: "Owner"
                  value: "<@${guild.owner_id}>"
                  inline: true
                - name: "Members"
                  value: "${guild.member_count|format}"
                  inline: true
                - name: "Created"
                  value: "${timestamp(guild.created_at, 'relative')}"
                  inline: true
                - name: "Boost Level"
                  value: "Tier ${guild.premium_tier}"
                  inline: true
              footer:
                text: "ID: ${guild.id}"

  # User info command
  - name: userinfo
    description: Get information about a user
    options:
      - name: user
        description: The user to look up
        type: user
        required: false
    actions:
      - reply:
          embeds:
            - title: "${options.user?.username ?? user.username}"
              thumbnail:
                url: "${options.user?.avatar ?? user.avatar}"
              color: "#5865F2"
              fields:
                - name: "ID"
                  value: "`${options.user?.id ?? user.id}`"
                  inline: true
                - name: "Created"
                  value: "${timestamp(options.user?.created_at ?? user.created_at, 'relative')}"
                  inline: true
                - name: "Bot"
                  value: "${(options.user?.bot ?? user.bot) ? 'Yes' : 'No'}"
                  inline: true
              timestamp: true

  # Roll dice command
  - name: roll
    description: Roll some dice
    options:
      - name: dice
        description: Number of dice (1-10)
        type: integer
        required: false
        min_value: 1
        max_value: 10
      - name: sides
        description: Sides per die (2-100)
        type: integer
        required: false
        min_value: 2
        max_value: 100
    actions:
      - reply:
          content: "Rolling ${options.dice ?? 1}d${options.sides ?? 6}... **${random(options.dice ?? 1, (options.dice ?? 1) * (options.sides ?? 6))}**"

  # 8ball command
  - name: 8ball
    description: Ask the magic 8-ball a question
    options:
      - name: question
        description: Your question
        type: string
        required: true
    actions:
      - reply:
          content: |
            **Question:** ${options.question}
            **Answer:** ${pick(['Yes', 'No', 'Maybe', 'Definitely', 'Absolutely not', 'Ask again later', 'Without a doubt', 'Very doubtful', 'It is certain', 'Cannot predict now'])}

  # Choose command
  - name: choose
    description: Choose between options
    options:
      - name: options
        description: Options separated by commas
        type: string
        required: true
    actions:
      - reply:
          content: "I choose: **${pick(split(options.options, ','))|trim}**"

# Event handlers
events:
  ready:
    actions:
      - log:
          level: info
          message: "Bot is ready! Serving ${bot.guilds|length} guilds"

  member_join:
    actions:
      - log:
          level: info
          message: "${user.username} joined ${guild.name}"

# Flows
flows:
  log_command:
    parameters:
      - name: command_name
        type: string
    actions:
      - increment:
          scope: global
          key: "command_count"
      - log:
          level: debug
          message: "Command executed: ${command_name}"
